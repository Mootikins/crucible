# Cargo configuration for Windows builds
#
# This file ensures consistent C runtime library linkage on Windows.
# Without this, you may encounter linker errors like:
#   error LNK2038: mismatch detected for 'RuntimeLibrary': 
#   value 'MT_StaticRelease' doesn't match value 'MD_DynamicRelease'
#
# By default, Rust on Windows uses dynamic runtime (MD), which matches
# most dependencies like ONNX Runtime (ort_sys). 
#
# If you encounter runtime mismatch errors:
# 1. Clean and rebuild: `cargo clean && cargo build`
# 2. Ensure all dependencies are rebuilt with consistent settings
# 3. If the issue persists, you may need to rebuild problematic dependencies
#    from source or use alternative providers

[target.'cfg(windows)']
# Explicitly use dynamic C runtime (MD) to match ONNX Runtime (ort_sys)
# This ensures all dependencies, including native ones built with cc crate,
# use the same runtime library setting.
#
# The cc crate (used by esaxx-rs) respects these environment variables:
# - CFLAGS with /MD flag forces dynamic runtime for C code
# - CXXFLAGS with /MD flag forces dynamic runtime for C++ code
#
# We explicitly disable static runtime linking to prevent mismatches
rustflags = ["-C", "target-feature=-crt-static"]

# Environment variables for cc crate to use dynamic runtime
[env]
# Force cc crate to use /MD (dynamic runtime) instead of /MT (static runtime)
# This is critical for esaxx-rs and other native dependencies
CFLAGS = "/MD"
CXXFLAGS = "/MD"

# Note: If you need static runtime instead (not recommended with ort_sys):
# 1. Comment out the rustflags line above
# 2. Change CFLAGS and CXXFLAGS to "/MT"
# 3. This will likely cause linker errors with ort_sys (ONNX Runtime)