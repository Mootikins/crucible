# Cargo configuration for Windows builds
#
# This file ensures consistent C runtime library linkage on Windows.
# Without this, you may encounter linker errors like:
#   error LNK2038: mismatch detected for 'RuntimeLibrary':
#   value 'MT_StaticRelease' doesn't match value 'MD_DynamicRelease'
#
# By default, Rust on Windows uses dynamic runtime (MD), which matches
# most dependencies like ONNX Runtime (ort_sys).
#
# IMPORTANT: This rustflags setting only affects Rust code compilation.
# Native dependencies using the `cc` crate may have hardcoded settings that
# override this. For example, esaxx-rs has `.static_crt(true)` hardcoded in
# its build.rs, which we work around by disabling the `esaxx_fast` feature
# in tokenizers (see crucible-llm/Cargo.toml).
#
# If you encounter runtime mismatch errors:
# 1. Clean and rebuild: `cargo clean && cargo build`
# 2. Check if a native dependency has hardcoded static_crt in its build.rs
# 3. Disable problematic features or find alternative crates

[target.'cfg(windows)']
# Explicitly use dynamic C runtime (MD) to match ONNX Runtime (ort_sys)
rustflags = ["-C", "target-feature=-crt-static"]

# Note: If you need static runtime instead (not recommended with ort_sys):
# 1. Comment out the rustflags lines above
# 2. Ensure native dependencies use "/MT" consistently
# 3. This will likely cause linker errors with ort_sys (ONNX Runtime)
# 4. You may need to patch or rebuild ort_sys with static runtime
