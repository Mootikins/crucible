# Development Configuration for Crucible
# This configuration is optimized for local development with Ollama
# Environment: development
# Format: YAML

# Active profile - this will be used by default
profile: "development"

# Profile configurations for different environments
profiles:
  # Development profile with local Ollama setup
  development:
    name: "development"
    description: "Local development environment with Ollama and debug logging"
    environment: "development"

    # Embedding provider configuration using local Ollama
    embedding_provider:
      type: "ollama"
      api:
        # Local Ollama instance - change if running on different host/port
        base_url: "http://localhost:11434"
        timeout_seconds: 60
        retry_attempts: 2
        # No API key needed for Ollama
        key: null
      model:
        # Popular embedding model for Ollama
        name: "nomic-embed-text"
        max_tokens: 2048
        dimensions: null  # Let Ollama handle dimensions
      # Ollama-specific options
      ollama_options:
        # Pull model if not available
        pull_on_missing: true
        # Use GPU acceleration if available
        use_gpu: true

    # Database configuration for development
    database:
      type: "sqlite"
      # Local SQLite database file
      url: "sqlite:./crucible_dev.db"
      max_connections: 10
      timeout_seconds: 30
      # SQLite-specific options
      journal_mode: "WAL"
      synchronous: "NORMAL"
      cache_size: 2000

    # Server configuration for development
    server:
      host: "127.0.0.1"
      port: 8080
      https: false
      # No TLS in development
      cert_file: null
      key_file: null
      max_body_size: 10485760  # 10MB
      timeout_seconds: 30
      # Development server options
      cors_enabled: true
      cors_origins: ["http://localhost:3000", "http://localhost:5173"]

    # Logging configuration for development
    logging:
      level: "debug"  # Verbose logging for development
      format: "text"
      file: false  # Console logging in development
      # If file logging is needed:
      # file: true
      # file_path: "./logs/crucible_dev.log"
      max_file_size: 10485760  # 10MB
      max_files: 3

    # Environment variables specific to development
    env_vars:
      RUST_LOG: "debug,crucible=trace"
      RUST_BACKTRACE: "1"
      # Development-specific flags
      CRUCIBLE_DEBUG: "true"
      CRUCIBLE_RELOAD_ON_CHANGE: "true"
      # Database development settings
      DATABASE_MIGRATE_ON_START: "true"
      DATABASE_RESET_ON_START: "false"

    # Development-specific settings
    settings:
      # Feature flags for development
      features:
        experimental_features: true
        debug_endpoints: true
        performance_monitoring: true
      # Development tools
      auto_reload: true
      mock_external_services: false  # Use real Ollama
      # UI/UX settings
      ui:
        show_performance_metrics: true
        enable_debug_panel: true

  # Testing profile for local testing
  testing:
    name: "testing"
    description: "Local testing environment with mocked services"
    environment: "test"

    # Mock embedding provider for testing
    embedding_provider:
      type: "custom"
      api:
        base_url: "http://localhost:11435"  # Mock server
        timeout_seconds: 5
        retry_attempts: 1
      model:
        name: "mock-embedding-model"
        dimensions: 768  # Fixed dimensions for testing
        max_tokens: 1000
      # Mock-specific options
      mock_options:
        return_fixed_embeddings: true
        embedding_size: 768
        response_delay_ms: 10

    # In-memory database for testing
    database:
      type: "sqlite"
      url: ":memory:"  # In-memory database
      max_connections: 1
      timeout_seconds: 5

    # Different port for testing
    server:
      host: "127.0.0.1"
      port: 8081
      https: false
      timeout_seconds: 10

    # Minimal logging for testing
    logging:
      level: "error"
      format: "text"
      file: false

    env_vars:
      RUST_LOG: "error"
      CRUCIBLE_TEST_MODE: "true"
      MOCK_EXTERNAL_APIS: "true"

    settings:
      testing:
        mock_apis: true
        disable_auth: true
        fast_failures: true

# Global default embedding provider (fallback if profile doesn't specify one)
embedding_provider:
  type: "ollama"
  api:
    base_url: "http://localhost:11434"
    timeout_seconds: 60
    retry_attempts: 2
  model:
    name: "nomic-embed-text"
    max_tokens: 2048

# Global default database configuration
database:
  type: "sqlite"
  url: "sqlite:./crucible.db"
  max_connections: 10
  timeout_seconds: 30

# Global server configuration
server:
  host: "127.0.0.1"
  port: 8080
  https: false
  timeout_seconds: 30

# Global logging configuration
logging:
  level: "info"
  format: "text"
  file: false

# Custom application settings
custom_settings:
  application:
    name: "Crucible"
    version: "1.0.0"
    description: "Local knowledge management system"

  development:
    hot_reload: true
    debug_mode: true
    experimental_features: true

  performance:
    embedding_batch_size: 10
    max_concurrent_requests: 50
    cache_ttl_seconds: 3600

  security:
    # Development security settings (relaxed)
    require_auth: false
    allowed_origins: ["*"]
    rate_limiting_enabled: false

# Environment-specific overrides can be applied using:
# CRUCIBLE_PROFILE=testing cargo run
# or by setting the profile field above