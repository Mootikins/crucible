#[test]
fn test_basic_rune_syntax() {
    // Basic syntax validation
    let a = 10;
    let b = 20;
    let result = a + b;
    assert_eq!(result, 30);
}

#[test]
fn test_agent_mappings_structure() {
    // Test the agent mappings structure
    let agent_mappings = #{
        claude: [
            ("commands", "commands"),
            ("config", "config"),
            ("contexts", "contexts"),
            ("tools", "tools"),
            ("workflows", "workflows")
        ],
        crush: [
            ("commands", "commands"),
            ("config", "config"),
            ("contexts", "contexts"),
            ("tools", "tools"),
            ("workflows", "workflows")
        ],
        cursor: [
            ("commands", "commands"),
            ("config", "config"),
            ("contexts", "contexts"),
            ("tools", "tools"),
            ("workflows", "workflows"),
            ("rules", "commands")  // Cursor uses "rules" for commands
        ]
    };

    assert_eq!(agent_mappings.claude.len(), 5);
    assert_eq!(agent_mappings.cursor.len(), 6);

    // Verify cursor has the special rules -> commands mapping
    let mut has_rules_mapping = false;
    for (agent_dir, global_dir) in agent_mappings.cursor {
        if agent_dir == "rules" && global_dir == "commands" {
            has_rules_mapping = true;
            break;
        }
    }
    assert!(has_rules_mapping);
}

#[test]
fn test_mcp_endpoint_structure() {
    // Test MCP endpoint definition structure
    let mcp_endpoints = [
        #{
            name: "agent-commands",
            description: "Agent command definitions",
            path: "commands"
        },
        #{
            name: "agent-configs", 
            description: "Agent configuration files",
            path: "config"
        },
        #{
            name: "agent-contexts",
            description: "Agent context definitions", 
            path: "contexts"
        },
        #{
            name: "agent-tools",
            description: "Agent tools and utilities",
            path: "tools"
        },
        #{
            name: "agent-workflows", 
            description: "Agent workflow definitions",
            path: "workflows"
        }
    ];

    assert_eq!(mcp_endpoints.len(), 5);
    
    // Validate each endpoint
    for endpoint in mcp_endpoints {
        assert!(endpoint.name != null && endpoint.name != "");
        assert!(endpoint.description != null && endpoint.description != "");
        assert!(endpoint.path != null && endpoint.path != "");
    }
}

#[test]
fn test_path_construction() {
    // Test path construction for agent symlinks
    let project_root = "/home/moot/crucible";
    let agent_name = "claude";
    let subdir = "commands";
    
    let agent_dir = format!("{}/.{}", project_root, agent_name);
    let agent_subdir = format!("{}/{}", agent_dir, subdir);
    let project_agents_dir = format!("{}/.agents/{}", project_root, subdir);
    
    assert_eq!(agent_dir, "/home/moot/crucible/.claude");
    assert_eq!(agent_subdir, "/home/moot/crucible/.claude/commands");
    assert_eq!(project_agents_dir, "/home/moot/crucible/.agents/commands");
}

#[test]
fn test_mcp_config_generation() {
    // Test MCP configuration generation
    let project_agents = "/home/moot/crucible/.agents";
    
    let mcp_endpoints = [
        #{
            name: "agent-commands",
            description: "Agent command definitions",
            path: "commands"
        },
        #{
            name: "agent-configs",
            description: "Agent configuration files", 
            path: "config"
        },
        #{
            name: "agent-contexts",
            description: "Agent context definitions",
            path: "contexts"
        }
    ];
    
    // Simulate config generation for each endpoint
    for endpoint in mcp_endpoints {
        let config_path = format!("{}/mcp/{}.json", project_agents, endpoint.name);
        let full_path = format!("{}/{}", project_agents, endpoint.path);
        
        // Validate generated paths
        assert!(config_path.contains("mcp"));
        assert!(config_path.contains(".json"));
        assert!(full_path.contains(endpoint.path));
    }
}

#[test]
fn test_agent_directory_structure() {
    // Test agent directory structure validation
    let agents = ["claude", "crush", "cursor"];
    
    for agent in agents {
        // Test that agent directory paths are properly formed
        let agent_dir = format!("/home/moot/crucible/.{}", agent);
        let commands_dir = format!("{}/commands", agent_dir);
        let config_dir = format!("{}/config", agent_dir);
        
        // Basic validation - ensure paths contain expected components
        assert!(agent_dir.contains(format!(".{}", agent)));
        assert!(commands_dir.contains("commands"));
        assert!(config_dir.contains("config"));
    }
}

#[test]
fn test_global_agent_mappings() {
    // Test mappings between global and project-specific agent configs
    let global_agents_root = "/home/moot/dotfiles/agents";
    let project_agents_root = "/home/moot/crucible/.agents";
    
    // Test that global and project paths are different
    assert!(global_agents_root != project_agents_root);
    
    // Test specific mapping paths
    let global_commands = format!("{}/dot-agents/commands", global_agents_root);
    let project_commands = format!("{}/commands", project_agents_root);
    
    assert!(global_commands.contains("dotfiles"));
    assert!(project_commands.contains("crucible"));
}

#[test]
fn test_mcp_integration_points() {
    // Test that MCP integration points exist and are properly configured
    let mcp_config = #{
        endpoints: [
            "commands",
            "config", 
            "contexts",
            "tools",
            "workflows"
        ],
        enabled: true,
        version: "1.0.0"
    };
    
    assert!(mcp_config.enabled == true);
    assert!(mcp_config.version == "1.0.0");
    assert_eq!(mcp_config.endpoints.len(), 5);
    
    // Verify all expected endpoints are present
    assert!(mcp_config.endpoints.contains("commands"));
    assert!(mcp_config.endpoints.contains("config"));
    assert!(mcp_config.endpoints.contains("contexts"));
    assert!(mcp_config.endpoints.contains("tools"));
    assert!(mcp_config.endpoints.contains("workflows"));
}

#[test]
fn test_symlink_validation() {
    // Test symlink validation logic
    let test_symlinks = #{
        source: "/home/moot/crucible/.agents/commands",
        target: "/home/moot/crucible/.claude/commands",
        valid: true
    };
    
    assert!(test_symlinks.source.contains(".agents"));
    assert!(test_symlinks.target.contains(".claude"));
    assert!(test_symlinks.valid == true);
}

#[test]
fn test_agent_configuration_completeness() {
    // Test that all agents have complete configurations
    let agent_configs = #{
        claude: #{
            commands: true,
            config: true,
            contexts: true,
            tools: true,
            workflows: true
        },
        crush: #{
            commands: true,
            config: true,
            contexts: true,
            tools: true,
            workflows: true
        },
        cursor: #{
            commands: true,
            config: true,
            contexts: true,
            tools: true,
            workflows: true,
            rules: true  // Special for cursor
        }
    };
    
    // Validate Claude
    assert!(agent_configs.claude.commands);
    assert!(agent_configs.claude.config);
    assert!(agent_configs.claude.contexts);
    assert!(agent_configs.claude.tools);
    assert!(agent_configs.claude.workflows);
    
    // Validate Crush
    assert!(agent_configs.crush.commands);
    assert!(agent_configs.crush.config);
    assert!(agent_configs.crush.contexts);
    assert!(agent_configs.crush.tools);
    assert!(agent_configs.crush.workflows);
    
    // Validate Cursor (has extra rules component)
    assert!(agent_configs.cursor.commands);
    assert!(agent_configs.cursor.config);
    assert!(agent_configs.cursor.contexts);
    assert!(agent_configs.cursor.tools);
    assert!(agent_configs.cursor.workflows);
    assert!(agent_configs.cursor.rules);  // Special for cursor
}

fn main() {
    println!("ðŸ§ª Running comprehensive agent symlink tests with MCP integration...");
    
    // Run all tests
    test_basic_rune_syntax();
    test_agent_mappings_structure();
    test_mcp_endpoint_structure();
    test_path_construction();
    test_mcp_config_generation();
    test_agent_directory_structure();
    test_global_agent_mappings();
    test_mcp_integration_points();
    test_symlink_validation();
    test_agent_configuration_completeness();
    
    println!("âœ… All tests passed! Agent symlink system with MCP integration is working correctly.");
}
